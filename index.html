<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>围炉夜话 - 线下互动游戏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #1a1f2e;
            color: #f0e6d2;
            min-height: 100vh;
            padding: 20px;
            background-image: radial-gradient(circle at 20% 30%, rgba(120, 119, 198, 0.1) 0%, transparent 20%),
                              radial-gradient(circle at 80% 80%, rgba(255, 119, 97, 0.1) 0%, transparent 20%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* 头部区域 */
        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(40, 44, 62, 0.9) 0%, rgba(32, 36, 50, 0.9) 100%);
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffd700, #ff6b6b, #4ecdc4, #45b7d1);
        }
        
        .game-title {
            font-size: 3.5rem;
            background: linear-gradient(to right, #ffd700, #ff8c00, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
            letter-spacing: 3px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a09b8c;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* 游戏状态区域 */
        .game-status {
            display: flex;
            justify-content: space-between;
            background-color: rgba(40, 44, 62, 0.8);
            padding: 15px 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }
        
        .status-item {
            text-align: center;
            flex: 1;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #a09b8c;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        /* 游戏提示区域 */
        .game-prompt {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, rgba(40, 44, 62, 0.9) 0%, rgba(32, 36, 50, 0.9) 100%);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            font-size: 1.2rem;
            color: #a09b8c;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 卡牌区域 */
        .cards-section {
            background: linear-gradient(135deg, rgba(40, 44, 62, 0.9) 0%, rgba(32, 36, 50, 0.9) 100%);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 25px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        
        .card {
            aspect-ratio: 3/4;
            background: linear-gradient(145deg, #2a2f45, #1f2335);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.1);
        }
        
        .card.flipped {
            cursor: default;
        }
        
        .card.flipped:hover {
            transform: none;
            border-color: transparent;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card-front {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            height: 100%;
            width: 100%;
            position: relative;
            z-index: 2;
        }
        
        .card-back {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(145deg, #2a2f45, #1f2335);
            border-radius: 15px;
            transform: rotateY(180deg);
            backface-visibility: hidden;
            transition: transform 0.8s;
            opacity: 0;
        }
        
        .card.flipped .card-front {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .card.flipped .card-back {
            transform: rotateY(0deg);
            opacity: 1;
        }
        
        .player-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .player-name {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
        }
        
        .card-result {
            font-size: 3.5rem;
            margin-bottom: 20px;
        }
        
        .card-message {
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            padding: 0 10px;
        }
        
        .win {
            color: #4ecdc4;
        }
        
        .lose {
            color: #ff6b6b;
        }
        
        /* 答题提示区域 */
        .answer-prompt {
            background: linear-gradient(135deg, rgba(40, 44, 62, 0.9) 0%, rgba(32, 36, 50, 0.9) 100%);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            text-align: center;
        }
        
        .answer-prompt.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .prompt-icon {
            font-size: 4rem;
            color: #ffd700;
            margin-bottom: 20px;
        }
        
        .prompt-title {
            font-size: 2rem;
            color: #4ecdc4;
            margin-bottom: 15px;
        }
        
        .question-box {
            background: rgba(26, 31, 46, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .question-label {
            color: #a09b8c;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .question-label i {
            color: #ffd700;
        }
        
        .question-text {
            font-size: 1.8rem;
            line-height: 1.5;
            color: #f0e6d2;
            text-align: center;
            padding: 10px;
        }
        
        .prompt-note {
            font-size: 1.1rem;
            color: #a09b8c;
            font-style: italic;
            margin-top: 20px;
        }
        
        /* 按钮样式 */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #ff8c00, #ff6b6b);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #4ecdc4, #45b7d1);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(69, 183, 209, 0.3);
        }
        
        .btn-start {
            background: linear-gradient(to right, #ffd700, #ff8c00);
            color: #1a1f2e;
            font-size: 1.3rem;
            padding: 18px 40px;
        }
        
        .btn-next {
            background: linear-gradient(to right, #4ecdc4, #45b7d1);
            color: white;
            font-size: 1.2rem;
        }
        
        /* 规则模态框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background: linear-gradient(135deg, rgba(40, 44, 62, 0.95) 0%, rgba(32, 36, 50, 0.95) 100%);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .modal-title {
            font-size: 2rem;
            color: #ffd700;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #a09b8c;
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: #ffd700;
        }
        
        .rules-list {
            margin-bottom: 30px;
        }
        
        .rule-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        
        .rule-number {
            background-color: #ffd700;
            color: #1a1f2e;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .rule-text {
            line-height: 1.6;
            color: #f0e6d2;
        }
        
        /* 响应式设计 */
        @media (max-width: 992px) {
            .cards-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .game-title {
                font-size: 2.8rem;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                gap: 15px;
            }
            
            .game-title {
                font-size: 2.2rem;
            }
            
            .question-text {
                font-size: 1.5rem;
                padding: 15px;
            }
            
            .cards-container {
                grid-template-columns: repeat(2, 1fr);
                max-width: 500px;
                margin: 0 auto;
            }
            
            .game-status {
                flex-direction: column;
                gap: 15px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .cards-container {
                grid-template-columns: 1fr;
                max-width: 300px;
            }
            
            .game-title {
                font-size: 1.8rem;
            }
            
            .question-text {
                font-size: 1.3rem;
            }
            
            .prompt-title {
                font-size: 1.5rem;
            }
            
            .card-result {
                font-size: 2.8rem;
            }
            
            .card-message {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 游戏头部 -->
        <header class="header">
            <h1 class="game-title">522的围炉夜话</h1>
            <p class="subtitle">线下四人问答游戏 - 四位玩家依次点击卡牌，其中一位抽中问题并口头回答</p>
        </header>
        
        <!-- 游戏状态 -->
        <div class="game-status">
            <div class="status-item">
                <div class="status-label">当前回合</div>
                <div class="status-value" id="current-round">1</div>
            </div>
            <div class="status-item">
                <div class="status-label">已回答问题</div>
                <div class="status-value"><span id="answered-count">0</span> / 20</div>
            </div>
            <div class="status-item">
                <div class="status-label">剩余问题</div>
                <div class="status-value" id="remaining-count">20</div>
            </div>
        </div>
        
        <!-- 游戏提示区域 -->
        <div class="game-prompt" id="game-prompt">
            游戏开始后，四位玩家依次点击卡牌抽取问题
        </div>
        
        <!-- 卡牌区域 -->
        <section class="cards-section">
            <h2 class="section-title"><i class="fas fa-users"></i> 玩家卡牌 - 依次点击</h2>
            <div class="cards-container" id="cards-container">
                <!-- 卡牌将通过JS动态生成 -->
            </div>
        </section>
        
        <!-- 答题提示区域 -->
        <section class="answer-prompt" id="answer-prompt">
            <div class="prompt-icon">
                <i class="fas fa-microphone-alt"></i>
            </div>
            <h2 class="prompt-title" id="prompt-title"></h2>
            
            <div class="question-box">
                <div class="question-label">
                    <i class="fas fa-question-circle"></i>
                    需要回答的问题
                </div>
                <div class="question-text" id="question-display"></div>
            </div>
            
            <p class="prompt-note">请抽中的玩家口头回答问题，回答完毕后点击"下一题"继续游戏</p>
            <div class="button-group">
                <button class="btn btn-next" id="next-question-btn">
                    <i class="fas fa-forward"></i> 下一题
                </button>
            </div>
        </section>
        
        <!-- 控制按钮 -->
        <div class="button-group">
            <button class="btn btn-start" id="start-game-btn">
                <i class="fas fa-play-circle"></i> 开始游戏
            </button>
            <button class="btn btn-secondary" id="show-rules-btn">
                <i class="fas fa-book"></i> 游戏规则
            </button>
            <button class="btn btn-secondary" id="reset-game-btn">
                <i class="fas fa-redo"></i> 重新开始
            </button>
        </div>
    </div>
    
    <!-- 规则模态框 -->
    <div class="modal-overlay" id="rules-modal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">围炉夜话 - 游戏规则</h2>
                <button class="close-modal" id="close-modal-btn">&times;</button>
            </div>
            
            <div class="rules-list">
                <div class="rule-item">
                    <div class="rule-number">1</div>
                    <p class="rule-text">游戏共有20个问题，4位玩家共同参与。</p>
                </div>
                <div class="rule-item">
                    <div class="rule-number">2</div>
                    <p class="rule-text">每轮游戏开始后，四位玩家依次点击自己的卡牌。</p>
                </div>
                <div class="rule-item">
                    <div class="rule-number">3</div>
                    <p class="rule-text">当有玩家抽中后，其他玩家不用再点击卡牌。</p>
                </div>
                <div class="rule-item">
                    <div class="rule-number">4</div>
                    <p class="rule-text">抽中的玩家需要口头回答当前显示的问题，其他玩家可以聆听或参与讨论。</p>
                </div>
                <div class="rule-item">
                    <div class="rule-number">5</div>
                    <p class="rule-text">回答完成后，点击"下一题"按钮进入下一回合。</p>
                </div>
                <div class="rule-item">
                    <div class="rule-number">6</div>
                    <p class="rule-text">游戏进行20个问题或所有玩家都参与多次后结束。</p>
                </div>
                <div class="rule-item">
                    <div class="rule-number">7</div>
                    <p class="rule-text">目标是与朋友们分享故事与想法，共度温馨夜晚，没有胜负之分。</p>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="start-from-modal-btn">
                    <i class="fas fa-play-circle"></i> 开始游戏
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // 游戏数据和状态
        const gameData = {
            // 20个问题
            questions: [
                "如果让你用三个词来形容2025，你会选择哪三个词语？",
                "你心目中最完美的理想型是什么样？",
                "如果不用考虑收入，你最想做什么样的工作？",
                "小时候有闯过什么至今不敢告诉家人的祸？如果没有的话小时候闯过最大的祸是什么？",
                "你害怕死亡吗？为什么",
                "你认为完美的一天应该是怎样的？",
                "更在意另一半的外貌还是性格？",
                "如果可以会选择更稳定的工作还是更自由的工作?",
                "重刷过多次的影视作品有哪些？",
                "恋爱中如果发现自己对另一个人动心了怎么办？",
                "你认为比较深的友谊应该是阶段性的，还是间歇持续性的？",
                "和另一个人在一起喜欢更重要还是合适更重要？",
                "如果时光能倒流的话有没有什么想要改变的事？",
                "如果要给自己的人生写一本自传，书名会叫什么？",
                "如果可以环游世界，你想最先去哪一个国家？",
                "有没有做过什么印象深刻的梦？",
                "此刻你手边最旧的那件物品，你是否还记得它的来历？",
                "找一个你认为跟自己最像的一个动物，说说为什么像它？",
                "列举出你与正对面的这个人的三个共同点",
                "如何看待边界感在关系中的重要性？"
            ],
            
            // 4位玩家
            players: [
                { id: 1, name: "玩家一", icon: "fas fa-user", answered: false },
                { id: 2, name: "玩家二", icon: "fas fa-user", answered: false },
                { id: 3, name: "玩家三", icon: "fas fa-user", answered: false },
                { id: 4, name: "玩家四", icon: "fas fa-user", answered: false }
            ],
            
            // 游戏状态
            currentQuestionIndex: 0,
            answeredQuestions: 0,
            currentRound: 1,
            gameStarted: false,
            winnerPlayerId: null,
            usedQuestions: new Set(),
            cardsFlipped: 0
        };

        // DOM元素
        const gamePrompt = document.getElementById('game-prompt');
        const cardsContainer = document.getElementById('cards-container');
        const answerPrompt = document.getElementById('answer-prompt');
        const promptTitle = document.getElementById('prompt-title');
        const questionDisplay = document.getElementById('question-display');
        const answeredCountDisplay = document.getElementById('answered-count');
        const currentRoundDisplay = document.getElementById('current-round');
        const remainingCountDisplay = document.getElementById('remaining-count');
        const startGameBtn = document.getElementById('start-game-btn');
        const showRulesBtn = document.getElementById('show-rules-btn');
        const resetGameBtn = document.getElementById('reset-game-btn');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const rulesModal = document.getElementById('rules-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const startFromModalBtn = document.getElementById('start-from-modal-btn');

        // 初始化游戏
        function initGame() {
            // 重置游戏数据
            gameData.currentQuestionIndex = 0;
            gameData.answeredQuestions = 0;
            gameData.currentRound = 1;
            gameData.gameStarted = false;
            gameData.winnerPlayerId = null;
            gameData.usedQuestions.clear();
            gameData.cardsFlipped = 0;
            
            // 重置玩家状态
            gameData.players.forEach(player => {
                player.answered = false;
            });
            
            // 更新显示
            updateDisplay();
            
            // 生成卡牌
            generateCards();
            
            // 隐藏答题提示区域
            answerPrompt.classList.remove('active');
            
            // 设置初始提示
            gamePrompt.textContent = "游戏开始后，四位玩家依次点击卡牌抽取问题";
            
            // 启用开始按钮
            startGameBtn.disabled = false;
            startGameBtn.innerHTML = '<i class="fas fa-play-circle"></i> 开始游戏';
        }

        // 生成玩家卡牌
        function generateCards() {
            cardsContainer.innerHTML = '';
            
            gameData.players.forEach(player => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.playerId = player.id;
                
                // 卡牌正面
                const cardFront = document.createElement('div');
                cardFront.className = 'card-front';
                
                const playerIcon = document.createElement('i');
                playerIcon.className = player.icon + ' player-icon';
                
                const playerName = document.createElement('div');
                playerName.className = 'player-name';
                playerName.textContent = player.name;
                
                const clickHint = document.createElement('div');
                clickHint.style.marginTop = '15px';
                clickHint.style.fontSize = '0.9rem';
                clickHint.style.color = '#a09b8c';
                clickHint.textContent = '点击抽取';
                
                cardFront.appendChild(playerIcon);
                cardFront.appendChild(playerName);
                cardFront.appendChild(clickHint);
                
                // 卡牌背面 - 简洁设计，只显示结果
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back';
                
                const cardResult = document.createElement('div');
                cardResult.className = 'card-result';
                
                const cardMessage = document.createElement('div');
                cardMessage.className = 'card-message';
                
                cardBack.appendChild(cardResult);
                cardBack.appendChild(cardMessage);
                
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                
                // 添加点击事件
                card.addEventListener('click', () => selectCard(player.id, card));
                
                cardsContainer.appendChild(card);
            });
        }

        // 选择卡牌
        function selectCard(playerId, cardElement) {
            if (!gameData.gameStarted) return;
            
            // 如果已经有玩家抽中，则不再处理
            if (gameData.winnerPlayerId !== null) return;
            
            // 如果卡牌已经翻转，则不再处理
            if (cardElement.classList.contains('flipped')) return;
            
            // 翻转卡牌
            cardElement.classList.add('flipped');
            gameData.cardsFlipped++;
            
            // 获取当前玩家
            const currentPlayer = gameData.players.find(p => p.id === playerId);
            
            // 判断是否中奖
            let isWinner = false;
            
            // 每个玩家有25%的概率中奖，但确保只有一个中奖者
            // 我们使用一个简单的逻辑：根据点击顺序决定
            // 第一个点击的有25%概率，第二个有33%概率（如果第一个没中），第三个有50%概率（如果前两个没中），第四个100%概率（如果前三个都没中）
            
            const remainingPlayers = gameData.players.length - (gameData.cardsFlipped - 1);
            const winProbability = 1 / remainingPlayers;
            
            isWinner = Math.random() < winProbability;
            
            if (isWinner) {
                gameData.winnerPlayerId = playerId;
            } else if (gameData.cardsFlipped === gameData.players.length) {
                // 如果所有卡牌都翻开了，但还没有中奖者，则让最后一张卡牌中奖
                isWinner = true;
                gameData.winnerPlayerId = playerId;
            }
            
            // 获取卡牌背面的元素
            const cardResult = cardElement.querySelector('.card-result');
            const cardMessage = cardElement.querySelector('.card-message');
            
            // 设置卡牌背面内容 - 简洁显示结果
            if (isWinner) {
                cardResult.innerHTML = '<i class="fas fa-trophy"></i>';
                cardResult.classList.add('win');
                cardMessage.textContent = '恭喜，你被抽中啦！( ﹡ˆoˆ﹡ )';
                cardMessage.classList.add('win');
                
                // 玩家抽中，立即显示答题提示
                setTimeout(() => {
                    showAnswerPrompt(currentPlayer);
                    
                    // 禁用所有未点击的卡牌
                    disableAllCards();
                    
                    // 更新游戏提示
                    gamePrompt.textContent = `${currentPlayer.name} 已抽中，请回答问题`;
                }, 800);
            } else {
                cardResult.innerHTML = '<i class="fas fa-times-circle"></i>';
                cardResult.classList.add('lose');
                cardMessage.textContent = '很遗憾，你未被抽中(╥﹏╥)';
                cardMessage.classList.add('lose');
                
                // 更新游戏提示
                const remainingPlayers = gameData.players.filter(p => {
                    const card = document.querySelector(`.card[data-player-id="${p.id}"]`);
                    return !card.classList.contains('flipped');
                });
                
                if (remainingPlayers.length > 0) {
                    gamePrompt.textContent = `${currentPlayer.name} 未抽中，请 ${remainingPlayers.map(p => p.name).join(' 或 ')} 继续点击卡牌`;
                }
            }
        }

        // 禁用所有卡牌
        function disableAllCards() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                if (!card.classList.contains('flipped')) {
                    // 翻转未点击的卡牌，显示未抽中
                    card.classList.add('flipped');
                    
                    const cardResult = card.querySelector('.card-result');
                    const cardMessage = card.querySelector('.card-message');
                    
                    cardResult.innerHTML = '<i class="fas fa-times-circle"></i>';
                    cardResult.classList.add('lose');
                    cardMessage.textContent = '未抽中';
                    cardMessage.classList.add('lose');
                }
                
                // 禁用所有卡牌的点击事件
                card.style.pointerEvents = 'none';
            });
        }

        // 显示答题提示区域
        function showAnswerPrompt(winnerPlayer) {
            promptTitle.textContent = `${winnerPlayer.name} 抽中了！`;
            questionDisplay.textContent = gameData.questions[gameData.currentQuestionIndex];
            
            // 显示答题提示区域
            answerPrompt.classList.add('active');
            
            // 滚动到提示区域
            answerPrompt.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // 下一题
        function nextQuestion() {
            // 标记玩家已回答
            const winnerPlayer = gameData.players.find(p => p.id === gameData.winnerPlayerId);
            if (winnerPlayer) {
                winnerPlayer.answered = true;
                gameData.answeredQuestions++;
                gameData.usedQuestions.add(gameData.currentQuestionIndex);
            }
            
            // 检查是否所有玩家都已回答过问题
            const allPlayersAnswered = gameData.players.every(player => player.answered);
            if (allPlayersAnswered) {
                gameData.currentRound++;
                // 重置玩家回答状态
                gameData.players.forEach(player => {
                    player.answered = false;
                });
            }
            
            // 获取新的问题索引（确保不重复）
            let newQuestionIndex;
            let attempts = 0;
            do {
                newQuestionIndex = Math.floor(Math.random() * gameData.questions.length);
                attempts++;
                // 防止无限循环
                if (attempts > 100) break;
            } while (gameData.usedQuestions.has(newQuestionIndex) && gameData.usedQuestions.size < gameData.questions.length);
            
            gameData.currentQuestionIndex = newQuestionIndex;
            
            // 重置游戏状态
            gameData.winnerPlayerId = null;
            gameData.cardsFlipped = 0;
            
            // 更新显示
            updateDisplay();
            
            // 重置所有卡牌
            resetCards();
            
            // 隐藏答题提示区域
            answerPrompt.classList.remove('active');
            
            // 检查游戏是否结束
            if (gameData.usedQuestions.size >= gameData.questions.length) {
                endGame();
            }
        }

        // 更新显示
        function updateDisplay() {
            // 更新游戏状态显示
            answeredCountDisplay.textContent = gameData.answeredQuestions;
            currentRoundDisplay.textContent = gameData.currentRound;
            remainingCountDisplay.textContent = gameData.questions.length - gameData.answeredQuestions;
            
            // 重置游戏提示
            gamePrompt.textContent = "请点击任意卡牌开始抽取";
        }

        // 重置卡牌
        function resetCards() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.classList.remove('flipped');
                card.style.pointerEvents = 'auto';
                
                // 重置背面内容
                const cardResult = card.querySelector('.card-result');
                const cardMessage = card.querySelector('.card-message');
                
                if (cardResult) {
                    cardResult.innerHTML = '';
                    cardResult.className = 'card-result';
                }
                
                if (cardMessage) {
                    cardMessage.textContent = '';
                    cardMessage.className = 'card-message';
                }
            });
        }

        // 开始游戏
        function startGame() {
            gameData.gameStarted = true;
            startGameBtn.disabled = true;
            startGameBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 游戏进行中';
            
            // 初始化第一个问题
            gameData.currentQuestionIndex = Math.floor(Math.random() * gameData.questions.length);
            gameData.usedQuestions.add(gameData.currentQuestionIndex);
            
            // 更新显示
            updateDisplay();
            
            // 显示提示
            gamePrompt.textContent = "请点击任意卡牌开始抽取";
        }

        // 结束游戏
        function endGame() {
            gameData.gameStarted = false;
            
            // 禁用所有卡牌
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.style.pointerEvents = 'none';
                card.style.opacity = '0.7';
            });
            
            // 显示最终结果
            answerPrompt.classList.add('active');
            promptTitle.textContent = "游戏结束！";
            questionDisplay.innerHTML = `
                <p>本次游戏共进行了 ${gameData.answeredQuestions} 个问题。</p>
                <p>感谢各位玩家的参与！</p>
                <p>希望你们通过这些问题更加了解彼此，共度了美好时光。</p>
            `;
            
            // 修改按钮文本
            nextQuestionBtn.innerHTML = '<i class="fas fa-redo"></i> 重新开始';
            nextQuestionBtn.onclick = initGame;
            
            // 更新游戏提示
            gamePrompt.textContent = "游戏结束！所有问题已回答完毕";
            
            // 启用重新开始按钮
            startGameBtn.disabled = false;
            startGameBtn.innerHTML = '<i class="fas fa-redo"></i> 重新开始';
        }

        // 显示规则模态框
        function showRulesModal() {
            rulesModal.style.display = 'flex';
        }

        // 隐藏规则模态框
        function hideRulesModal() {
            rulesModal.style.display = 'none';
        }

        // 事件监听
        startGameBtn.addEventListener('click', startGame);
        resetGameBtn.addEventListener('click', initGame);
        showRulesBtn.addEventListener('click', showRulesModal);
        closeModalBtn.addEventListener('click', hideRulesModal);
        startFromModalBtn.addEventListener('click', () => {
            hideRulesModal();
            startGame();
        });
        nextQuestionBtn.addEventListener('click', nextQuestion);
        
        // 点击模态框外部关闭
        rulesModal.addEventListener('click', (e) => {
            if (e.target === rulesModal) {
                hideRulesModal();
            }
        });
        
        // 初始化游戏
        initGame();
    </script>
</body>
</html>